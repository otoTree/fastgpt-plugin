# DBOps (数据库操作工具)

专业的数据库连接和查询工具集，支持主流数据库的 SQL 执行操作。在 FastGPT 工作流中可以直接连接您的数据库进行数据查询和处理。

## 🚀 支持的数据库

- **MySQL** - 最流行的关系型数据库
- **PostgreSQL** - 强大的开源关系型数据库  
- **Microsoft SQL Server** - 企业级关系型数据库
- **Oracle** - 大型商业关系型数据库
- **ClickHouse** - 高性能分析型数据库

## 📋 使用方法

### 通用步骤

1. 在 FastGPT 工作流中添加「数据库操作」工具节点
2. 选择您使用的数据库类型
3. 填写数据库连接信息
4. 输入要执行的 SQL 语句
5. 运行工作流获取查询结果

### MySQL 连接配置

**必填参数：**
- **数据库名称** - 要连接的数据库名称
- **主机名** - 数据库服务器地址（如：mysql.yourdomain.com、123.45.67.89）
- **数据库连接端口号** - MySQL 端口号（默认：3306）
- **数据库账号** - 数据库用户名
- **数据库密码** - 数据库密码

**可选参数：**
- **字符集** - 数据库字符集（默认：utf8mb4）
- **时区** - 数据库时区设置（默认：+00:00）
- **最大连接数** - 连接池最大连接数（默认：10）
- **连接超时时间** - 连接超时时间毫秒（默认：30000）

**输入参数：**
- **SQL** - 要执行的 SQL 语句（必填）

---

### PostgreSQL 连接配置

**必填参数：**
- **主机名** - 数据库服务器地址（如：postgres.yourdomain.com、123.45.67.89）
- **数据库连接端口号** - PostgreSQL 端口号（默认：5432）
- **数据库账号** - 数据库用户名
- **数据库密码** - 数据库密码

**可选参数：**
- **数据库名称** - 要连接的数据库名称
- **最大连接数** - 连接池最大连接数（默认：10）
- **连接超时时间** - 连接超时时间毫秒（默认：30000）

**输入参数：**
- **SQL** - 要执行的 SQL 语句（必填）

---

### Microsoft SQL Server 连接配置

**必填参数：**
- **数据库名称** - 要连接的数据库名称
- **主机名** - 数据库服务器地址（如：sqlserver.yourdomain.com、123.45.67.89）
- **数据库连接端口号** - SQL Server 端口号（默认：1433）
- **数据库账号** - 数据库用户名
- **数据库密码** - 数据库密码

**可选参数：**
- **域名** - Windows 域身份验证时需要
- **实例名称** - SQL Server 实例名称
- **最大连接数** - 连接池最大连接数（默认：10）
- **连接超时时间** - 连接超时时间毫秒（默认：30000）

**输入参数：**
- **SQL** - 要执行的 SQL 语句（必填）

---

### Oracle 连接配置

**必填参数：**
- **数据库账号** - Oracle 用户名
- **数据库密码** - Oracle 密码
- **connectString** - 连接字符串（格式：host:port/SID，如：oracle.yourdomain.com:1521/ORCLCDB）

**可选参数：**
- **最大连接数** - 连接池最大连接数（默认：10）
- **连接超时时间** - 连接超时时间毫秒（默认：30000）

**输入参数：**
- **SQL** - 要执行的 SQL 语句（必填）

---

### ClickHouse 连接配置

**必填参数：**
- **数据库名称** - 要连接的数据库名称
- **URL** - ClickHouse HTTP 接口地址（如：https://clickhouse.yourdomain.com:8443、http://123.45.67.89:8123）
- **数据库账号** - 数据库用户名
- **数据库密码** - 数据库密码

**可选参数：**
- **最大连接数** - 连接池最大连接数（默认：10）
- **连接超时时间** - 连接超时时间毫秒（默认：30000）

**输入参数：**
- **SQL** - 要执行的 SQL 语句（必填）

## 💡 使用技巧

### SQL 语句示例

**查询数据：**
```sql
SELECT * FROM users WHERE age > 18
```

**统计分析：**
```sql
SELECT COUNT(*) as total, AVG(price) as avg_price FROM orders
```

**数据更新：**
```sql
UPDATE products SET stock = stock - 1 WHERE id = '123'
```

**数据插入：**
```sql
INSERT INTO logs (message, created_at) VALUES ('操作完成', NOW())
```

### 参数传递

您可以在工作流中使用变量引用，动态构建 SQL 语句：

- 使用 `变量引用` 选项，连接上一个节点的输出作为 SQL 语句
- 支持在 SQL 语句中包含变量和条件逻辑
- 可以通过其他节点动态生成查询条件

### 安全建议

- ⚠️ **安全第一**：数据库密码将以加密方式存储
- 📋 **最小权限**：建议为 FastGPT 创建专门的数据库用户，只授予必要的查询权限
- 🔒 **网络隔离**：确保数据库只允许可信的网络连接
- 📝 **审计日志**：定期检查数据库操作日志

## 🎯 典型应用场景

### 1. 数据查询和分析
- 从业务数据库查询用户信息
- 分析销售数据和报表
- 实时数据监控和统计

### 2. 数据验证和清洗
- 验证数据的完整性和准确性
- 批量数据清洗和格式化
- 重复数据检测和处理

### 3. 智能客服集成
- 查询客户订单状态
- 获取产品信息和库存
- 验证用户身份和权限

### 4. 工作流自动化
- 定时数据备份和归档
- 自动化报告生成
- 数据同步和迁移

## ⚠️ 注意事项

1. **连接测试**：首次连接前请确保数据库服务正常运行
2. **权限管理**：确保数据库用户具有执行相应 SQL 的权限
3. **性能考虑**：复杂查询可能影响数据库性能，建议在业务低峰期执行
4. **错误处理**：如果 SQL 执行失败，检查语法和数据库名称是否正确
5. **资源限制**：大量数据查询可能受到内存和时间限制

## 📞 技术支持

如果遇到连接问题，请检查：

1. 数据库服务是否正常运行
2. 外网网络连接是否畅通（尝试 ping 域名）
3. 防火墙和安全组是否开放相应端口
4. 数据库是否允许外网访问
5. 用户名和密码是否正确
6. 数据库用户权限配置是否正确
7. SSL/TLS 连接是否需要（某些数据库要求加密连接）

> 💡 **提示**：首次使用建议先用简单的 `SELECT 1` 测试连接是否成功。